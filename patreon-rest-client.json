{"name":"patreon-rest-client","master":true,"version":"1.0.0","description":"Basic REST client\n\n1. New schemas must inherit from 'SyncComponent'\n2. Run the application\n3. Now all modications to components will send POST/DELETE/PATCH requests to the server\n4. Basic web tables to browse are available on 127.0.0.1:8080/patreon-rest-client.hml","schemas":{"p18852151e81b1e3":{"_id":"p18852151e81b1e3","_name":"RestClient","_inherit":["_Component"],"ssl":"property","ip":"property","port":"property","apiName":"property","pushEnabled":"property"},"1723516a30132ac":{"_id":"1723516a30132ac","_name":"_Database","_inherit":["_Component"],"_core":true,"insert":"event","update":"event","remove":"event"},"104ad1f48518376":{"_id":"104ad1f48518376","_name":"_Channel","_inherit":["_Component"],"send":"event","serverDatabaseInsert":"event","serverDatabaseRemove":"event","serverDatabaseUpdate":"event","serverGetResult":"event","clientDatabaseInsert":"event","clientDatabaseRemove":"event","clientDatabaseUpdate":"event","clientGet":"event"},"n1d0e31337a1a5f5":{"_id":"n1d0e31337a1a5f5","_name":"SyncComponent","_inherit":["_Component"]},"k1d3c518b0317618":{"_id":"k1d3c518b0317618","_name":"HttpRequest","_inherit":["_Component"],"get":"method","post":"method","patch":"method","del":"method"},"h1edbe1d76e1a2e1":{"_id":"h1edbe1d76e1a2e1","_name":"PushRequest","_inherit":["_Component"],"listen":"method"},"user":{"_id":"user","_name":"User","_inherit":["SyncComponent"],"firstName":"property","lastName":"property","email":"property","phone":"property","role":"property","password":"property","business":"link"},"serviceCategory":{"_id":"serviceCategory","_name":"ServiceCategory","_inherit":["SyncComponent"],"name":"property","active":"property","services":"collection"},"serviceProvider":{"_id":"serviceProvider","_name":"ServiceProvider","_inherit":["Business"],"rating":"property","services":"collection","employees":"collection"},"project":{"_id":"project","_name":"Project","_inherit":["SyncComponent"],"name":"property","description":"property","client":"link","startDate":"property","endDate":"property","sites":"collection","contracts":"collection"},"booking":{"_id":"booking","_name":"Booking","_inherit":["SyncComponent"],"project":"link","client":"link","site":"link","startDate":"property","endDate":"property","service":"link","serviceProvider":"link","jobsheets":"collection"},"contract":{"_id":"contract","_name":"Contract","_inherit":["SyncComponent"],"project":"link","name":"property","client":"link","description":"property","budget":"property","start":"property","end":"property","status":"property","file":"property","services":"collection","bookings":"collection"},"client":{"_id":"client","_name":"Client","_inherit":["Business"],"projects":"collection","contracts":"collection","bookings":"collection"},"dispute":{"_id":"dispute","_name":"Dispute","_inherit":["SyncComponent"],"booking":"link","contract":"link","status":"property","created":"property","reportedUser":"link","reportedBy":"link","comments":"property","notes":"property"},"resource":{"_id":"resource","_name":"Resource","_inherit":["SyncComponent"]},"transactions":{"_id":"transactions","_name":"Transactions","_inherit":["SyncComponent"]},"service":{"_id":"service","_name":"Service","_inherit":["SyncComponent"],"name":"property","state":"property","staffNumber":"property","serviceCategory":"link","asset":"link","description":"property","rating":"property","active":"property","subService":"collection"},"asset":{"_id":"asset","_name":"Asset","_inherit":["SyncComponent"],"type":"property","name":"property","licenseNo":"property","serialNo":"property","model":"property","make":"property"},"employee":{"_id":"employee","_name":"Employee","_inherit":["User","SyncComponent"],"emergencyContact":"property","emergencyPhone":"property","jobs":"collection"},"jobsheet":{"_id":"jobsheet","_name":"JobSheet","_inherit":["SyncComponent"],"booking":"link","start":"property","end":"property","client":"link","project":"link","employee":"link"},"business":{"_id":"business","_name":"Business","_inherit":["SyncComponent"],"type":"property","name":"property","abn":"property","address":"property","phone":"property","primaryContact":"link","users":"collection"},"site":{"_id":"site","_name":"Site","_inherit":["SyncComponent"],"name":"property","client":"link","address":"property"},"template-schema":{"_id":"template-schema","_name":"Template","_inherit":["_Component"],"source":"property","render":"method"},"list-schema":{"_id":"list-schema","_name":"List","_inherit":["_Component"],"filter":"property","render":"method"},"css-schema":{"_id":"css-schema","_name":"CSS","_inherit":["_Component"],"source":"property","render":"method"}},"models":{"y1f4fa12f37118ce":{"_id":"y1f4fa12f37118ce","_name":"RestClient","ip":{"type":"string","readOnly":false,"mandatory":false,"default":"127.0.0.1"},"port":{"type":"string","readOnly":false,"mandatory":false,"default":"8080"},"apiName":{"type":"string","readOnly":false,"mandatory":false,"default":"/rest"},"ssl":{"type":"boolean","readOnly":false,"mandatory":false,"default":false},"pushEnabled":{"type":"boolean","readOnly":false,"mandatory":false,"default":false}},"a18245170ae12e8b":{"_id":"a18245170ae12e8b","_name":"_Database","_core":true,"insert":{"params":[{"name":"event","type":"dbInsertEvent"}]},"update":{"params":[{"name":"event","type":"dbUpdateEvent"}]},"remove":{"params":[{"name":"event","type":"dbRemoveEvent"}]}},"f1c2361dfff1428f":{"_id":"f1c2361dfff1428f","_name":"_Channel","send":{"params":[{"name":"message","type":"message"}]},"serverDatabaseInsert":{"params":[{"name":"event","type":"dbInsertEvent","mandatory":false,"default":{}}]},"serverDatabaseRemove":{"params":[{"name":"event","type":"dbRemoveEvent","mandatory":false,"default":{}}]},"serverDatabaseUpdate":{"params":[{"name":"event","type":"dbUpdateEvent","mandatory":false,"default":{}}]},"serverGetResult":{"params":[{"name":"event","type":"getResultEvent","mandatory":false,"default":{}}]},"clientDatabaseInsert":{"params":[{"name":"event","type":"dbInsertEvent","mandatory":false,"default":{}}]},"clientDatabaseRemove":{"params":[{"name":"event","type":"dbRemoveEvent","mandatory":false,"default":{}}]},"clientDatabaseUpdate":{"params":[{"name":"event","type":"dbUpdateEvent","mandatory":false,"default":{}}]},"clientGet":{"params":[{"name":"event","type":"getEvent","mandatory":false,"default":{}}]}},"o1a56a137671baa8":{"_id":"o1a56a137671baa8","_name":"SyncComponent"},"p17f0f136c11bca0":{"_id":"p17f0f136c11bca0","_name":"HttpRequest","patch":{"params":[{"name":"collection","type":"string","mandatory":false,"default":""},{"name":"id","type":"string","mandatory":false,"default":""},{"name":"field","type":"string","mandatory":false,"default":""},{"name":"value","type":"string","mandatory":false,"default":""}]},"del":{"params":[{"name":"collection","type":"string","mandatory":false,"default":""},{"name":"id","type":"string","mandatory":false,"default":""}]},"post":{"params":[{"name":"collection","type":"string","mandatory":false,"default":""},{"name":"doc","type":"object","mandatory":false,"default":null}]},"get":{"params":[{"name":"collection","type":"string","mandatory":false,"default":""},{"name":"id","type":"string","mandatory":false,"default":""}]}},"a16f401e3a41e134":{"_id":"a16f401e3a41e134","_name":"PushRequest","listen":{}},"b7f251a8-032d-46af-ac3a-7d65e880aac0":{"_id":"b7f251a8-032d-46af-ac3a-7d65e880aac0","_name":"User","_description":"The base object reprsenting one real person who interacts with the system","firstName":{"description":"The name they are known by","type":"string","readOnly":false,"mandatory":false,"default":""},"lastName":{"description":"Legal last name as matches employers records","type":"string","readOnly":false,"mandatory":false,"default":""},"email":{"description":"Used for authentication and communication, should be a private account in a business domain.","type":"string","readOnly":false,"mandatory":false,"default":""},"phone":{"description":"Best contact number, preferrably a mobile but landlines acceptable","type":"string","readOnly":false,"mandatory":false,"default":""},"role":{"description":"The role defines what features and functions they hve access to, and establishes how we expect them to interact.","type":"Role","readOnly":false,"mandatory":false,"default":"gremlin"},"password":{"description":"Make it secure.","type":"string","readOnly":false,"mandatory":false,"default":""},"business":{"description":"","type":"Business","kind":"dependency","readOnly":false,"mandatory":false,"default":{}}},"a2acf62e-31a2-4f55-97e6-d10ba8ee462e":{"_id":"a2acf62e-31a2-4f55-97e6-d10ba8ee462e","_name":"ServiceCategory","_description":"","name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"active":{"description":"","type":"boolean","readOnly":false,"mandatory":false,"default":true},"services":{"description":"","type":["Service"],"kind":"aggregation","readOnly":false,"mandatory":false,"default":[]}},"ac6b4c22-f6b5-49e6-b6e0-54615f84f29a":{"_id":"ac6b4c22-f6b5-49e6-b6e0-54615f84f29a","_name":"Project","_description":"","name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"description":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"startDate":{"description":"Project start date","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"endDate":{"description":"Project end date","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"contracts":{"description":"","type":["Contract"],"readOnly":false,"mandatory":false,"default":[]},"sites":{"description":"","type":["Site"],"kind":"normal","readOnly":false,"mandatory":false,"default":[]},"client":{"description":"","type":"Client","kind":"dependency","readOnly":false,"mandatory":false,"default":""}},"ae605371-3f95-4ad9-ad26-415d82c31d4f":{"_id":"ae605371-3f95-4ad9-ad26-415d82c31d4f","_name":"Booking","_description":"","project":{"description":"","type":"Project","kind":"dependency","readOnly":false,"mandatory":false,"default":""},"client":{"description":"","type":"Client","kind":"dependency","readOnly":false,"mandatory":false,"default":""},"site":{"description":"","type":"Site","kind":"dependency","readOnly":false,"mandatory":false,"default":{}},"startDate":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"endDate":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"service":{"description":"","type":"Service","kind":"dependency","readOnly":false,"mandatory":false,"default":{}},"serviceProvider":{"description":"","type":"ServiceProvider","kind":"dependency","readOnly":false,"mandatory":false,"default":""},"jobsheets":{"description":"","type":["jobsheet"],"kind":"normal","readOnly":false,"mandatory":false,"default":[]}},"cc963f95-65d4-4c72-9a56-ccef49005871":{"_id":"cc963f95-65d4-4c72-9a56-ccef49005871","_name":"Contract","_description":"","project":{"description":"","type":"Project","kind":"aggregation","readOnly":false,"mandatory":false,"default":{}},"name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"client":{"description":"","type":"Client","kind":"normal","readOnly":false,"mandatory":false,"default":{}},"description":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"budget":{"description":"","type":"number","readOnly":false,"mandatory":false,"default":0},"start":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"end":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"status":{"description":"","type":"ContractStatus","readOnly":false,"mandatory":false,"default":"draft"},"file":{"description":"","type":"any","readOnly":false,"mandatory":false,"default":""},"services":{"description":"","type":["Service"],"kind":"aggregation","readOnly":false,"mandatory":false,"default":[]},"bookings":{"description":"","type":["Booking"],"kind":"aggregation","readOnly":false,"mandatory":false,"default":[]}},"c0a1dd3c-a8ff-4e53-a8f4-eac3f59f3ba4":{"_id":"c0a1dd3c-a8ff-4e53-a8f4-eac3f59f3ba4","_name":"Calendar","_description":""},"eb571373-0457-4be4-99e7-8ebcdd0d1fc3":{"_id":"eb571373-0457-4be4-99e7-8ebcdd0d1fc3","_name":"Dispute","_description":"","booking":{"description":"","type":"Booking","kind":"dependency","readOnly":false,"mandatory":false,"default":""},"contract":{"description":"","type":"Contract","kind":"dependency","readOnly":false,"mandatory":false,"default":""},"status":{"description":"","type":"DisputeStatus","readOnly":false,"mandatory":false,"default":"new"},"created":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"reportedUser":{"description":"","type":"Employee","kind":"normal","readOnly":false,"mandatory":false,"default":""},"reportedBy":{"description":"","type":"User","kind":"dependency","readOnly":false,"mandatory":false,"default":""},"comments":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"notes":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""}},"fff2d389-f19a-4a50-ae10-48570ddd53c1":{"_id":"fff2d389-f19a-4a50-ae10-48570ddd53c1","_name":"Resource","_description":""},"da2c83f2-fa1c-4f15-a6d5-ed459da7c6a3":{"_id":"da2c83f2-fa1c-4f15-a6d5-ed459da7c6a3","_name":"Transactions","_description":""},"f3f384b6-7bdb-407d-9f75-111644239d64":{"_id":"f3f384b6-7bdb-407d-9f75-111644239d64","_name":"Service","_description":"","name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"state":{"description":"","type":"State","readOnly":false,"mandatory":false,"default":"QLD"},"rating":{"description":"","type":"number","readOnly":false,"mandatory":false,"default":5},"staffNumber":{"description":"","type":"number","readOnly":false,"mandatory":false,"default":1},"serviceCategory":{"description":"","type":"ServiceCategory","kind":"composition","readOnly":false,"mandatory":false,"default":""},"asset":{"description":"","type":"Asset","kind":"aggregation","readOnly":false,"mandatory":false,"default":{}},"description":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"subService":{"description":"","type":["Service"],"kind":"aggregation","readOnly":false,"mandatory":false,"default":[]},"active":{"description":"","type":"boolean","readOnly":false,"mandatory":false,"default":true}},"b4170147-858a-4195-9b0a-77ee531b60d0":{"_id":"b4170147-858a-4195-9b0a-77ee531b60d0","_name":"Asset","_description":"","type":{"description":"","type":"AssetTypes","readOnly":false,"mandatory":false,"default":"machinery"},"licenseNo":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"model":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"make":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"serialNo":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""}},"cacbc73f-71be-475b-aa73-1a2da4d512aa":{"_id":"cacbc73f-71be-475b-aa73-1a2da4d512aa","_name":"Employee","_description":"","emergencyContact":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"emergencyPhone":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"jobs":{"description":"","type":["Booking"],"kind":"aggregation","readOnly":false,"mandatory":false,"default":[]}},"e4a9f575-ec8f-4e98-aa28-c917f23b958d":{"_id":"e4a9f575-ec8f-4e98-aa28-c917f23b958d","_name":"JobSheet","_description":"","booking":{"description":"","type":"Booking","kind":"dependency","readOnly":false,"mandatory":false,"default":{}},"start":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"end":{"description":"","type":"date","readOnly":false,"mandatory":false,"default":"1970-01-01T00:00:00.000Z"},"client":{"description":"","type":"Client","kind":"normal","readOnly":false,"mandatory":false,"default":{}},"project":{"description":"","type":"Project","kind":"normal","readOnly":false,"mandatory":false,"default":{}},"employee":{"description":"","type":"User","kind":"dependency","readOnly":false,"mandatory":false,"default":{}}},"a039a6ea-e2f3-4531-a720-ccd733936031":{"_id":"a039a6ea-e2f3-4531-a720-ccd733936031","_name":"Business","_description":"","type":{"description":"","type":"BusinessType","readOnly":false,"mandatory":false,"default":"client"},"name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"abn":{"description":"","type":"number","readOnly":false,"mandatory":false,"default":0},"address":{"description":"","type":"Address","readOnly":false,"mandatory":false,"default":{}},"phone":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"primaryContact":{"description":"","type":"User","kind":"dependency","readOnly":false,"mandatory":false,"default":{}},"users":{"description":"","type":["User"],"readOnly":false,"mandatory":false,"default":[]}},"bbbf0be9-83f1-45aa-9742-d3e95f97b010":{"_id":"bbbf0be9-83f1-45aa-9742-d3e95f97b010","_name":"Site","_description":"","name":{"description":"","type":"string","readOnly":false,"mandatory":false,"default":""},"client":{"description":"","type":"Client","kind":"dependency","readOnly":false,"mandatory":false,"default":{}},"address":{"description":"","type":"Address","readOnly":false,"mandatory":false,"default":{}}},"client":{"_id":"client","_name":"Client","_description":"","projects":{"description":"","type":["Project"],"readOnly":false,"mandatory":false,"default":[]},"contracts":{"description":"","type":["Contract"],"readOnly":false,"mandatory":false,"default":[]},"bookings":{"description":"","type":["Booking"],"readOnly":false,"mandatory":false,"default":[]}},"ecc4ef40-d150-4980-bb45-23a0e81aa034":{"_id":"ecc4ef40-d150-4980-bb45-23a0e81aa034","_name":"ServiceProvider","_description":"","rating":{"description":"","type":"any","readOnly":false,"mandatory":false,"default":""},"services":{"description":"","type":["Service"],"kind":"normal","readOnly":false,"mandatory":false,"default":[]},"employees":{"description":"","type":["Employee"],"kind":"normal","readOnly":false,"mandatory":false,"default":[]}},"template-model":{"_id":"template-model","_name":"Template","source":{"description":"html of the template","type":"html","readOnly":false,"mandatory":false,"default":""},"render":{"description":"render the template","params":[{"name":"elt","type":"DOMElement","mandatory":false,"default":null}]}},"list-model":{"_id":"list-model","_name":"List","render":{"description":"render the list"},"filter":{"description":"filter on the list","type":"string","readOnly":false,"mandatory":false,"default":"{}"}},"css-model":{"_id":"css-model","_name":"CSS","source":{"description":"css of the component","type":"css","readOnly":false,"mandatory":false,"default":""},"render":{"description":"render the component"}}},"behaviors":{"p16272155eb1def6":{"_id":"p16272155eb1def6","component":"b199d91a7d310943","state":"start","action":"function start() { \n \n    // for server push event\n  if (this.require('restClient').pushEnabled()) {\n    this.require('pushRequest').listen();\n  }\n  \n  // add HTML\n  this.require('template').render();\n  \n  // add CSS\n  this.require('list.css').render();\n  \n  // init the filter\n  this.require('list').filter('');\n  \n  // show the list\n  this.require('list').render();\n  \n  // add listener\n  document.getElementById('search').addEventListener('keyup', function keyup(e) {\n    this.require('list').filter(e.target.value.trim());\n  }.bind(this));\n\n}","useCoreAPI":false,"core":false},"1de8c154bb18a01":{"_id":"1de8c154bb18a01","component":"_Database","state":"insert","action":"function insert(event) { \n  var logs = [],\n      lastInsertOrder = -1;\n     \n  if ($metamodel.inheritFrom(event.collection, 'SyncComponent')) {\n\n    // search if last insert action before this one \n    // was a message from the server or not\n    logs = $db._Log.find({\n      'action': 'insert',\n      'id': event.document._id\n    });\n    \n    if (logs.length) {\n      logs.sort(function sort(logA, logB) {\n        return logA.order - logB.order;\n      });\n      lastInsertOrder = logs[0].order;\n    }\n    \n    logs = $db._Log.find({\n      'order': lastInsertOrder - 1,\n      'collection': '_Message'\n    });\n\n    switch (true) {\n      case !logs[0]:\n      case logs[0] && \n           logs[0].value.event !== 'serverDatabaseInsert':\n      case logs[0] && logs[0].value.event === 'serverDatabaseInsert' && \n           logs[0].value.data[0].document._id !== event.document._id:\n           \n        // send the event to another system   \n        this.require('channel').clientDatabaseInsert(event);\n        break;\n      default:\n        break;\n    }\n  }\n}","useCoreAPI":true,"core":false},"173ff13cde1c29e":{"_id":"173ff13cde1c29e","component":"_Database","state":"remove","action":"function remove(event) { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      body = '',\n      lastInsertOrder = -1,\n      systemId = this.require('runtime').system().id();\n      \n if ($metamodel.inheritFrom(event.collection, 'SyncComponent')) {\n  \n    // search if last remove action before this one \n    // was a message from the server or not\n    logs = $db._Log.find({\n      'action': 'remove',\n      'id': event.id\n    });\n    \n    if (logs.length) {\n      logs.sort(function sort(logA, logB) {\n        return logA.order - logB.order;\n      });\n      lastInsertOrder = logs[0].order;\n    }\n    \n    logs = $db._Log.find({\n      'order': lastInsertOrder - 1,\n      'collection': '_Message'\n    });\n    \n    switch (true) {\n      case !logs[0]:\n      case logs[0] && \n           logs[0].value.event !== 'serverDatabaseRemove':\n      case logs[0] && logs[0].value.event === 'serverDatabaseRemove' && \n           logs[0].value.data[0].collection !== event.collection &&\n           logs[0].value.data[0].id !== event.id:\n           \n        // send the event to another system    \n        this.require('channel').clientDatabaseRemove(event);\n        break;\n      default:\n        break;\n    }\n  }\t\n}","useCoreAPI":true,"core":false},"1e0a71b78c1fd0e":{"_id":"1e0a71b78c1fd0e","component":"_Database","state":"update","action":"function update(event) { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      body = {},\n      logs = [],\n      lastInsertOrder = -1,\n      systemId = this.require('runtime').system().id();\n      \nif ($metamodel.inheritFrom(event.collection, 'SyncComponent')) {\n  \n    // search if last insert action before this one \n    // was a message from the server or not\n    logs = $db._Log.find({\n      'action': 'update',\n      'id': event.id\n    });\n    \n    if (logs.length) {\n      logs.sort(function sort(logA, logB) {\n        return logA.order - logB.order;\n      });\n      lastInsertOrder = logs[0].order;\n    }\n    \n    logs = $db._Log.find({\n      'order': lastInsertOrder - 1,\n      'collection': '_Message'\n    });\n    \n    switch (true) {\n      case !logs[0]:\n      case logs[0] && \n           logs[0].value.event !== 'serverDatabaseUpdate':\n      case logs[0] && logs[0].value.event === 'serverDatabaseUpdate' && \n           logs[0].value.data[0].id !== event.id && \n           logs[0].value.data[0].field !== event.field &&\n           logs[0].value.data[0].value !== event.value:\n           \n        // send the event to another system   \n        this.require('channel').clientDatabaseUpdate(event);\n        break;\n      default:\n        break;\n    }\n  }\n}","useCoreAPI":true,"core":false},"t1a74b1a3f8109c2":{"_id":"t1a74b1a3f8109c2","component":"_Channel","state":"serverDatabaseInsert","action":"function serverDatabaseInsert(event) { \n  var collection = this.require('db').collections()[event.collection],\n      result = [];\n    \n  result = collection.find({\n    '_id': event.document._id\n  });\n  \n  if (result.length === 0) {\n    collection.insert(event.document);\n  }\n}","useCoreAPI":false,"core":false},"v1189411f7619879":{"_id":"v1189411f7619879","component":"_Channel","state":"serverDatabaseRemove","action":"function serverDatabaseRemove(event) { \n  var collection = this.require('db').collections()[event.collection],\n      result = [];\n      \n  result = collection.find({\n    '_id': event.id\n  });\n  \n  if (result.length !== 0) {\n    collection.remove({\n      '_id': event.id\n    });\n  }\n}","useCoreAPI":false,"core":false},"p1001b116f31e25b":{"_id":"p1001b116f31e25b","component":"_Channel","state":"serverDatabaseUpdate","action":"function serverDatabaseUpdate(event) { \n  var update = {},\n      collection = this.require('db').collections()[event.collection],\n      result = [],\n      doc = null;\n    \n  result = collection.find({\n    '_id': event.id\n  });\n  doc = result[0];\n\n  update[event.field] = event.value;\n  if (doc[event.field] !== event.value) {\n    collection.update({\n        '_id': event.id\n      },\n      update\n    );\t\n  }\n}","useCoreAPI":false,"core":false},"g13c27181741875d":{"_id":"g13c27181741875d","component":"HttpRequest","state":"patch","action":"function patch(collection, id, field, value) { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      systemId = this.require('runtime').system().id(),\n      body = {};\n  \n  if (restClient.ssl()) {\n    url = 'https://';\n  }\n  url = url + restClient.ip() + ':' + restClient.port() + '/' + restClient.apiName() + '/';\n  url = url.replace(/\\/\\//g, '/');\n  url = url + collection + '/' + id;\n  \n  body[field] = value;\n  \n  fetch(url, {\n    method: 'PATCH',\n    headers: new Headers({\n\t    'Content-Type': 'application/json',\n\t    'X-System-Id': systemId,\n\t    'X-System-Event': 'clientDatabaseUpdate'\n    }),\n    body: JSON.stringify(body)\n  });\n}","useCoreAPI":false,"core":false},"p1c13c187e715d33":{"_id":"p1c13c187e715d33","component":"HttpRequest","state":"del","action":"function del(collection, id) { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      systemId = this.require('runtime').system().id();  \n  \n  if (restClient.ssl()) {\n    url = 'https://';\n  }\n  url = url + restClient.ip() + ':' + restClient.port() + '/' + restClient.apiName() + '/';\n  url = url.replace(/\\/\\//g, '/');\n  url = url + collection + '/' + id;\n  \n  fetch(url, {\n    method: 'DELETE',\n    headers: new Headers({\n\t    'Content-Type': 'application/json',\n\t    'X-System-Id': systemId,\n\t    'X-System-Event': 'clientDatabaseRemove'\n    })\n  });\n}","useCoreAPI":false,"core":false},"x1997111f5e161ce":{"_id":"x1997111f5e161ce","component":"HttpRequest","state":"post","action":"function post(collection, doc) { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      systemId = this.require('runtime').system().id();\n  \n  if (restClient.ssl()) {\n    url = 'https://';\n  }\n  url = url + restClient.ip() + ':' + restClient.port() + '/' + restClient.apiName() + '/';\n  url = url.replace(/\\/\\//g, '/');\n  url = url + collection;\n  \n  fetch(url, {\n    method: 'POST',\n    headers: new Headers({\n\t    'Content-Type': 'application/json',\n\t    'X-System-Id': systemId,\n\t    'X-System-Event': 'clientDatabaseInsert'\n    }),\n    body: JSON.stringify(doc)\n  });\n}","useCoreAPI":false,"core":false},"g18f431534a1466a":{"_id":"g18f431534a1466a","component":"PushRequest","state":"listen","action":"function listen() { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      source = null;\n      \n  if (restClient.ssl()) {\n    url = 'https://';\n  }\n  url = url + restClient.ip() + ':' + restClient.port() + '/stream';\n  source = new EventSource(url);\n  \n  source.addEventListener('serverDatabaseInsert', function serverDatabaseInsert(event) {\n    // a message has arrived from another system\n    this.require('runtime').message(JSON.parse(event.data));\n  }.bind(this));\n  \n  source.addEventListener('serverDatabaseRemove', function serverDatabaseRemove(event) {\n    // a message has arrived from another system\n    this.require('runtime').message(JSON.parse(event.data));\n  }.bind(this));\n  \n  source.addEventListener('serverDatabaseUpdate', function serverDatabaseUpdate(event) {\n    // a message has arrived from another system\n    this.require('runtime').message(JSON.parse(event.data));\n  }.bind(this));\n}","useCoreAPI":false,"core":false},"h1efac1d27212324":{"_id":"h1efac1d27212324","component":"_Channel","state":"send","action":"function send(message) { \n  \n  // send the message to the server (which is another system)\n  \n  switch (message.event) {\n    case 'clientGet':\n      this.require('httpRequest').get(message.data[0].collection, message.data[0].id);\n      break;\n    case 'clientDatabaseInsert':\n      this.require('httpRequest').post(message.data[0].collection, message.data[0].document);\n      break;\n    case 'clientDatabaseUpdate':\n      this.require('httpRequest').patch(message.data[0].collection, message.data[0].id, message.data[0].field, message.data[0].value);\n      break;\n     case 'clientDatabaseRemove':\n      this.require('httpRequest').del(message.data[0].collection, message.data[0].id);\n      break;\n   default:\n      break;\n  }\n}","useCoreAPI":false,"core":false},"o1322514c4017bfd":{"_id":"o1322514c4017bfd","component":"HttpRequest","state":"get","action":"function get(collection, id) { \n  var restClient = this.require('restClient'),\n      url = 'http://',\n      systemId = this.require('runtime').system().id();\n  \n  if (restClient.ssl()) {\n    url = 'https://';\n  }\n  url = url + restClient.ip() + ':' + restClient.port() + '/' + restClient.apiName() + '/';\n  url = url.replace(/\\/\\//g, '/');\n  if (id) {\n    url = url + collection + '/' + id;\n  } else {\n    url = url + collection;\n  }\n  \n  fetch(url, {\n    method: 'GET',\n    headers: new Headers({\n\t    'Content-Type': 'application/json',\n\t    'X-System-Id': systemId,\n\t    'X-System-Event': 'clientGet'\n    })\n  }).then(function (response) {\n    response.json().then(function (response) {\n      // a message has arrived from another system\n      runtime.message(response);\n    });\n  });\n}","useCoreAPI":false,"core":false},"x161ee1ad1d14e88":{"_id":"x161ee1ad1d14e88","component":"_Channel","state":"serverGetResult","action":"function serverGetResult(event) { \n  var collection = this.require('db').collections()[event.collection];\n    \n  event.result.forEach(function (doc) {\n    collection.insert(doc);\n  });\n}","useCoreAPI":false,"core":false},"a2510015-701d-4674-a84a-77aeb84a05a0":{"_id":"a2510015-701d-4674-a84a-77aeb84a05a0","component":"Template","state":"render","action":"function render(elt) { \n  let html = this.source(),\n      domNode = elt;\n  \n  if (html) {\n    if (domNode === null) {\n      domNode = document.body;\n    }\n    \n    domNode.insertAdjacentHTML('beforeend', html);\n  }\n}","useCoreAPI":false,"core":false},"a436bd77-2789-47d2-98a0-7a62b8edf6ef":{"_id":"a436bd77-2789-47d2-98a0-7a62b8edf6ef","component":"List","state":"render","action":"function render() { \n let items = [],\n      properties = {},\n      links = {},\n      html = '',\n      criteria = null,\n      table = document.getElementById('table');\n      \n  \n  if (table) {\n  \n    // get data\n    if (this.filter().trim() !== '') {\n      criteria = new RegExp(this.filter().trim(), 'gi');\n      items = this.require('db').collections().Employee.find({\n        firstName: criteria\n      });\n    } else {\n      items = this.require('db').collections().Employee.find();\n    }\n    \n    properties = this.require('Employee').classInfo().properties();\n    links = this.require('Employee').classInfo().links();\n    \n    html = '<tr>';\n    // build table header\n    properties.forEach(function(property) {\n      html = html + '<th scope=\"col\">' + property.toUpperCase() +'</th>'; \n    });\n    links.forEach(function (link) {\n      html = html + '<th scope=\"col\">' + link.toUpperCase() +'</th>'; \n    });\n    html = html + '<tr>';\n    \n    // build table body\n    items.forEach(function (item){\n      html = html + '<tr>';\n      \n      properties.forEach(function(property) {\n        html = html + '<td>' + item[property] + '</td>';\n      });\n      \n      links.forEach(function (link) {\n        const business = this.require(item[link]);\n        \n        if (business) {\n          html = html + '<td>' + business.name() + '</td>';\n        } else {\n          html = html + '<td></td>';\n        }\n      }.bind(this));\n      \n      html = html + '</tr>';\n    }.bind(this));\n    \n    html = html + '</table>';\n    \n    table.innerHTML = html;\n  }\n}","useCoreAPI":false,"core":false},"b4b0dd67-ab50-484b-adf2-9b3465650c90":{"_id":"b4b0dd67-ab50-484b-adf2-9b3465650c90","component":"CSS","state":"render","action":"function render() { \n  let div = document.createElement('style');\n  div.innerHTML = this.source();\n  document.head.appendChild(div);\n}","useCoreAPI":false,"core":false},"eef4869a-d79d-45b5-96c8-bf115a3dcac1":{"_id":"eef4869a-d79d-45b5-96c8-bf115a3dcac1","component":"List","state":"filter","action":"function filter(value) { \n\tthis.render();\n}","useCoreAPI":false,"core":false},"f7d6db98-934b-489f-b933-213243545c80":{"_id":"f7d6db98-934b-489f-b933-213243545c80","component":"Business","state":"init","action":"function init(conf) { \n  this.require('list').render();\t\n}","useCoreAPI":false,"core":false},"f26faaa2-8671-42ab-bf93-bc210417c374":{"_id":"f26faaa2-8671-42ab-bf93-bc210417c374","component":"Business","state":"destroy","action":"function destroy() { \n  this.require('list').render();\n\n  // destroy the component\n  $component.destroy(this.id());\n}","useCoreAPI":true,"core":false}},"types":{"dbUpdateEvent":{"_id":"1f5c41309711752","name":"dbUpdateEvent","type":"object","schema":{"collection":{"type":"string","mandatory":true,"default":""},"id":{"type":"string","mandatory":true,"default":""},"field":{"type":"string","mandatory":true,"default":""},"value":{"type":"any","mandatory":true,"default":null}}},"dbRemoveEvent":{"_id":"1952e1ac4213f4a","name":"dbRemoveEvent","type":"object","schema":{"collection":{"type":"string","mandatory":true,"default":""},"id":{"type":"string","mandatory":true,"default":""}}},"dbInsertEvent":{"_id":"148ef1e19810e6d","name":"dbInsertEvent","type":"object","schema":{"collection":{"type":"string","mandatory":true,"default":""},"document":{"type":"object","mandatory":true,"default":{}}}},"message":{"name":"message","type":"object","schema":{"event":{"type":"string","mandatory":true},"from":{"type":"string","mandatory":false},"data":{"type":"object","mandatory":true}},"core":true},"getEvent":{"_id":"b1efcf180241f0f2","name":"getEvent","type":"object","schema":{"collection":{"type":"string","mandatory":false,"default":""},"id":{"type":"string","mandatory":false,"default":""}}},"getResultEvent":{"_id":"h1f8e11b4e21689d","name":"getResultEvent","type":"object","schema":{"collection":{"type":"string","mandatory":false,"default":""},"id":{"type":"string","mandatory":false,"default":""},"result":{"type":"array","mandatory":false,"default":[]}}},"Role":{"_id":"f8e3da5f-ab50-4b34-a1d6-88b1e3235eae","name":"Role","description":"Defines the available user roles","type":"string","value":["admin","supplier","employee","client","gremlin"]},"State":{"_id":"d7b89f3e-b0f7-4345-958e-752ee2e49bd0","name":"State","description":"","type":"string","value":["ACT","NSW","NT","SA","Vic","QLD","WA"]},"Address":{"_id":"c4f21f61-b80e-4adf-be6b-3d5d365c5736","name":"Address","description":"","type":"object","schema":{"number":{"description":"","type":"string","mandatory":false,"default":""},"street":{"description":"","type":"string","mandatory":false,"default":""},"suburb":{"description":"","type":"string","mandatory":false,"default":""},"state":{"description":"","type":"State","mandatory":false,"default":""},"postCode":{"description":"","type":"string","mandatory":false,"default":""}}},"AssetTypes":{"_id":"f63b1f5d-8127-4e6c-99c6-d5ed83899f4f","name":"AssetTypes","description":"The broad categories of Asset","type":"string","value":["vehicle","machinery"]},"BusinessType":{"_id":"caaa4cf7-a22b-46ae-91e2-b36893ef9998","name":"BusinessType","description":"Identifies whether the usiness pprovides services or consumes them","type":"string","value":["supplier","client"]},"AccountStatus":{"_id":"dcb796e0-f1b5-4686-8652-774441fe0c26","name":"AccountStatus","description":"","type":"string","value":["active","inactive"]},"DisputeStatus":{"_id":"dcb796e0-f1b5-4686-8652-774441fe0c26","name":"DisputeStatus","description":"","type":"string","value":["new","inProgress","onHold","resolved"]},"ContractStatus":{"_id":"eee7ca03-6a58-4bcf-afd5-652bb32acaaa","name":"ContractStatus","description":"","type":"any","value":["draft","active","complete"]},"DOMElement":{"_id":"cc1829ae-cf63-4e84-bc48-75514762c585","name":"DOMElement","type":"object"}},"components":{"RestClient":{"restClient":{"_id":"restClient","apiName":"/rest","ip":"127.0.0.1","port":"8080","ssl":false,"pushEnabled":false}},"_Channel":{"channel":{"_id":"channel"}},"HttpRequest":{"httpRequest":{"_id":"httpRequest"}},"PushRequest":{"pushRequest":{"_id":"pushRequest"}},"ServiceProvider":{"f67e8c04-9db8-4371-97ba-ca4b006f65df":{"_id":"f67e8c04-9db8-4371-97ba-ca4b006f65df","abn":5544333458,"address":{"number":"5","street":"Dog St","suburb":"Logan","state":"QLD","postCode":"8765"},"name":"Patreon","phone":"1300 876 543","primaryContact":"f63285db-1514-40fa-9bf5-443a5567e0e2","type":"supplier","rating":5,"services":["e4285551-64d8-4c70-a342-dd5dc7a534dc","e4285551-64d8-4c70-a342-dd5dc7a534dc","c88a94a9-bbbc-478e-bd14-e053aa2b09a","fa64cd49-2585-49ed-bf85-1de27a6258b4"],"employees":["f63285db-1514-40fa-9bf5-443a5567e0e2","ef083059-dd56-4b48-9d2f-f5446f040d23"],"users":[]}},"Employee":{"ef083059-dd56-4b48-9d2f-f5446f040d23":{"_id":"ef083059-dd56-4b48-9d2f-f5446f040d23","business":"f67e8c04-9db8-4371-97ba-ca4b006f65df","email":"dave@patreon.com","emergencyContact":"Jill - Wife","emergencyPhone":"0454 456 789","firstName":"Dave","jobs":[],"lastName":"Rankin","password":"xxxx","phone":"0456 789 987","role":"employee"},"f63285db-1514-40fa-9bf5-443a5567e0e2":{"_id":"f63285db-1514-40fa-9bf5-443a5567e0e2","business":"f67e8c04-9db8-4371-97ba-ca4b006f65df","email":"jo@patreon.com","emergencyContact":"Danny - Son","emergencyPhone":"0432 456 789","firstName":"Jo","jobs":[],"lastName":"Walker","password":"xxxx","phone":"0456 789 987","role":"employee"}},"Business":{},"Client":{"e5603ae1-0c4a-4303-9387-10edc935bc2c":{"_id":"e5603ae1-0c4a-4303-9387-10edc935bc2c","abn":77654466544,"address":{},"bookings":[],"contracts":[],"name":"Lend Lease","phone":"07 66554433","primaryContact":"e8a1a181-24dc-41b0-ac8c-b28f42323d13","projects":[],"type":"client","users":["e8a1a181-24dc-41b0-ac8c-b28f42323d13"]}},"User":{"e8a1a181-24dc-41b0-ac8c-b28f42323d13":{"_id":"e8a1a181-24dc-41b0-ac8c-b28f42323d13","business":"e5603ae1-0c4a-4303-9387-10edc935bc2c","email":"natalie@lease.com","firstName":"Natalie","lastName":"Pod","password":"xxx","phone":"1300 654 654","role":"client"}},"Project":{"d08b9dba-afe2-4245-a3f7-2ed48ba71fce":{"_id":"d08b9dba-afe2-4245-a3f7-2ed48ba71fce","contracts":[],"description":"details details","endDate":"1970-01-01T00:00:00.000Z","name":"M1 Tunnel","startDate":"1970-01-01T00:00:00.000Z","sites":[],"client":"e5603ae1-0c4a-4303-9387-10edc935bc2c"}},"Contract":{"ac1dc886-bf21-4817-93e9-d09d1c8bb7c0":{"_id":"ac1dc886-bf21-4817-93e9-d09d1c8bb7c0","bookings":[],"budget":0,"client":"e5603ae1-0c4a-4303-9387-10edc935bc2c","description":"","end":"1970-01-01T00:00:00.000Z","file":"doc.pdf","name":"M1 Nerang to Robina","project":"d08b9dba-afe2-4245-a3f7-2ed48ba71fce","services":[],"start":"1970-01-01T00:00:00.000Z","status":"draft"}},"Asset":{},"ServiceCategory":{"c39009b2-3854-4ec4-babd-ca612abfe1ec":{"_id":"c39009b2-3854-4ec4-babd-ca612abfe1ec","active":true,"name":"Utility Inspections","services":["e4285551-64d8-4c70-a342-dd5dc7a534dc","e4285551-64d8-4c70-a342-dd5dc7a534dc"]},"cc1bbbae-7f48-4ef9-b334-68a3b4932291":{"_id":"cc1bbbae-7f48-4ef9-b334-68a3b4932291","active":true,"name":"Utility Maintenance","services":["c88a94a9-bbbc-478e-bd14-e053aa2b09a","fa64cd49-2585-49ed-bf85-1de27a6258b4"]}},"Service":{"c2b4da6e-e4f7-4543-b0c1-30a65e7faa0a":{"_id":"c2b4da6e-e4f7-4543-b0c1-30a65e7faa0a","active":true,"asset":{},"description":"Camera viewing along pipes","name":"CCTV Pile Inspection","rating":5,"serviceCategory":"c39009b2-3854-4ec4-babd-ca612abfe1ec","staffNumber":2,"state":"QLD","subService":[]},"e4285551-64d8-4c70-a342-dd5dc7a534dc":{"_id":"e4285551-64d8-4c70-a342-dd5dc7a534dc","active":true,"asset":{},"description":"Ensure the portals are safe","name":"Manhole Inspection","rating":5,"serviceCategory":"c39009b2-3854-4ec4-babd-ca612abfe1ec","staffNumber":1,"state":"QLD","subService":[]},"fa64cd49-2585-49ed-bf85-1de27a6258b4":{"_id":"fa64cd49-2585-49ed-bf85-1de27a6258b4","active":true,"asset":{},"description":"Pstch up the pipes","name":"Pipe  Patching","rating":5,"serviceCategory":"cc1bbbae-7f48-4ef9-b334-68a3b4932291","staffNumber":1,"state":"QLD","subService":[]},"c88a94a9-bbbc-478e-bd14-e053aa2b09a1":{"_id":"c88a94a9-bbbc-478e-bd14-e053aa2b09a1","active":true,"asset":{},"description":"","name":"Defect Locating","rating":5,"serviceCategory":"cc1bbbae-7f48-4ef9-b334-68a3b4932291","staffNumber":1,"state":"QLD","subService":[]}},"CSS":{"list.css":{"_id":"list.css","source":"body {\n  padding-top: 50px;\n  font-family: \"Helvetica Neue\",Helvetica,Arial,sans-serif;\n}\n\n.input-group {\n  padding-bottom:20px;\n}\n\ntable {\n  font-family: arial, sans-serif;\n  border-collapse: collapse;\n  width: 100%;\n}\n\ntd, th {\n  border: 1px solid #dddddd;\n  text-align: left;\n  padding: 8px;\n}\n\nth {\n  background-color: #e7e7e7;\n}"}},"Template":{"template":{"_id":"template","source":"<div class=\"input-group\">\n  <input id=\"search\" type=\"text\" class=\"form-control\" placeholder=\"search for a user name\">\n</div>\n\n<table id=\"table\"></table>"}},"List":{"list":{"_id":"list","filter":""},"user-list":{"_id":"user-list","filter":""},"service-list":{"_id":"service-list","filter":""},"business-list":{"_id":"business-list","filter":""}}},"_id":"b199d91a7d310943"}